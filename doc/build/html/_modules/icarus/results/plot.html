
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>icarus.results.plot &#8212; Icarus 0.8.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxdoc.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Icarus 0.8.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">icarus.results.plot</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for icarus.results.plot</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;Plot results read from a result set</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">icarus.util</span> <span class="kn">import</span> <span class="n">Tree</span><span class="p">,</span> <span class="n">step_cdf</span>
<span class="kn">from</span> <span class="nn">icarus.tools</span> <span class="kn">import</span> <span class="n">means_confidence_interval</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;plot_lines&quot;</span><span class="p">,</span> <span class="s2">&quot;plot_bar_chart&quot;</span><span class="p">,</span> <span class="s2">&quot;plot_cdf&quot;</span><span class="p">]</span>


<span class="c1"># These lines prevent insertion of Type 3 fonts in figures</span>
<span class="c1"># Publishers don&#39;t want them. However, in some case these commands block the</span>
<span class="c1"># embedding of fonts raising complaints for example from EDAS</span>
<span class="c1"># plt.rcParams[&#39;ps.useafm&#39;] = True</span>
<span class="c1"># plt.rcParams[&#39;pdf.use14corefonts&#39;] = True</span>

<span class="c1"># If True text is interpreted as LaTeX, e.g. underscore are interpreted as</span>
<span class="c1"># subscript. If False, text is interpreted literally</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;text.usetex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Aspect ratio of the output figures</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span>

<span class="c1"># Size of font in legends</span>
<span class="n">LEGEND_SIZE</span> <span class="o">=</span> <span class="mi">14</span>

<span class="c1"># Plot</span>
<span class="n">PLOT_EMPTY_GRAPHS</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Catalogue of possible bw shades (for bar charts)</span>
<span class="n">BW_COLOR_CATALOGUE</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;0.2&quot;</span><span class="p">,</span> <span class="s2">&quot;0.3&quot;</span><span class="p">,</span> <span class="s2">&quot;0.4&quot;</span><span class="p">,</span> <span class="s2">&quot;0.5&quot;</span><span class="p">,</span> <span class="s2">&quot;0.6&quot;</span><span class="p">,</span> <span class="s2">&quot;0.7&quot;</span><span class="p">,</span> <span class="s2">&quot;0.8&quot;</span><span class="p">,</span> <span class="s2">&quot;0.9&quot;</span><span class="p">]</span>

<span class="c1"># Catalogue of possible hatch styles (for bar charts)</span>
<span class="n">HATCH_CATALOGUE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;//&quot;</span><span class="p">,</span>
    <span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="s2">&quot;*&quot;</span><span class="p">,</span>
    <span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;|&quot;</span><span class="p">,</span>
    <span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="s2">&quot;O&quot;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="plot_lines"><a class="viewcode-back" href="../../../apidoc/icarus.results.html#icarus.results.plot.plot_lines">[docs]</a><span class="k">def</span> <span class="nf">plot_lines</span><span class="p">(</span><span class="n">resultset</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">plotdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a graph with characteristics described in the plot descriptor out</span>
<span class="sd">    of the data contained in the resultset and save the plot in given directory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rs : ResultSet</span>
<span class="sd">        Result set</span>
<span class="sd">    desc : dict</span>
<span class="sd">        The plot descriptor (more info below)</span>
<span class="sd">    filename : str</span>
<span class="sd">        The name used to save the file. The file format is determined by the</span>
<span class="sd">        extension of the file. For example, if this filename is &#39;foo.pdf&#39;, the</span>
<span class="sd">        file will be saved in pdf format.</span>
<span class="sd">    plotdir : str</span>
<span class="sd">        The directory in which the plot will be saved.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The plot descriptor is a dictionary with a set of values that describe how</span>
<span class="sd">    to make the plot.</span>

<span class="sd">    The dictionary can contain the following keys:</span>
<span class="sd">     * title : str, optional.</span>
<span class="sd">           The title of the graph</span>
<span class="sd">     * xlabel : str, optional</span>
<span class="sd">         The x label</span>
<span class="sd">     * ylabel : str, optional</span>
<span class="sd">         The y label</span>
<span class="sd">     * errorbar : bool, optional</span>
<span class="sd">         If *True* error bars will be plotted. Default value is *True*</span>
<span class="sd">     * confidence : float, optional</span>
<span class="sd">         The confidence used to plot error bars. Default value is 0.95</span>
<span class="sd">     * xparam : iterable</span>
<span class="sd">         Path to the value of the x axis metric, e.g. [&#39;workload&#39;, &#39;alpha&#39;]</span>
<span class="sd">     * xvals : list</span>
<span class="sd">         Range of x values, e.g. [0.6, 0.7, 0.8, 0.9]</span>
<span class="sd">     * filter : dict, optional</span>
<span class="sd">         A dictionary of values to filter in the resultset.</span>
<span class="sd">         Example: {&#39;network_cache&#39;: 0.004, &#39;topology_name&#39;: &#39;GEANT&#39;}</span>
<span class="sd">         If not specified or None, no filtering is executed on the results</span>
<span class="sd">         and possibly heterogeneous results may be plotted together</span>
<span class="sd">     * ymetrics : list of tuples</span>
<span class="sd">         List of metrics to be shown on the graph. The i-th metric of the list</span>
<span class="sd">         is the metric that the i-th line on the graph will represent. If</span>
<span class="sd">         all lines are for the same metric, then all elements of the list are</span>
<span class="sd">         equal.</span>
<span class="sd">         Each single metric (i.e. each element of the list) is a tuple modeling</span>
<span class="sd">         the path to identify a specific metric into an entry of a result set.</span>
<span class="sd">         Normally, it is a 2-value list where the first value is the name of</span>
<span class="sd">         the collector which measured the metric and the second value is the</span>
<span class="sd">         metric name. Example values could be (&#39;CACHE_HIT_RATIO&#39;, &#39;MEAN&#39;),</span>
<span class="sd">         (&#39;LINK_LOAD&#39;, &#39;MEAN_INTERNAL&#39;) or (&#39;LATENCY&#39;, &#39;MEAN&#39;).</span>
<span class="sd">         For example, if in a graph of N lines all lines of the graph show mean</span>
<span class="sd">         latency, then ymetrics = [(&#39;LATENCY&#39;, &#39;MEAN&#39;)]*5.</span>
<span class="sd">     * ycondnames : list of tuples, optional</span>
<span class="sd">         List of condition names specific to each line of the graph. Different</span>
<span class="sd">         from the conditions expressed in the filter parameter, which are</span>
<span class="sd">         global, these conditions are specific to one bar. Ech condition name,</span>
<span class="sd">         different from the filter parameter is a path to a condition to be</span>
<span class="sd">         checked, e.g. (&#39;topology&#39;, &#39;name&#39;). Values to be matched for this</span>
<span class="sd">         conditions are specified in ycondvals. This list must be as long as</span>
<span class="sd">         the number of lines to plot. If not specified, all lines are filtered</span>
<span class="sd">         by the conditions of filter parameter only, but in this case all</span>
<span class="sd">         ymetrics should be different.</span>
<span class="sd">     * ycondvals : list of tuples, optional</span>
<span class="sd">         List of values that the conditions of ycondnames must meet. This list</span>
<span class="sd">         must be as long as the number of lines to plot. If not specified,</span>
<span class="sd">         all lines are filtered by the conditions of filter parameter only,</span>
<span class="sd">         but in this case all ymetrics should be different.</span>
<span class="sd">     * xscale : (&#39;linear&#39; | &#39;log&#39;), optional</span>
<span class="sd">         The scale of x axis. Default value is &#39;linear&#39;</span>
<span class="sd">     * yscale : (&#39;linear&#39; | &#39;log&#39;), optional</span>
<span class="sd">         The scale of y axis. Default value is &#39;linear&#39;</span>
<span class="sd">     * xticks : list, optional</span>
<span class="sd">         Values to display as x-axis ticks.</span>
<span class="sd">     * yticks : list, optional</span>
<span class="sd">         Values to display as y-axis ticks.</span>
<span class="sd">     * line_style : dict, optional</span>
<span class="sd">         Dictionary mapping each value of yvals with a line style</span>
<span class="sd">     * plot_args : dict, optional</span>
<span class="sd">         Additional args to be provided to the Pyplot errorbar function.</span>
<span class="sd">         Example parameters that can be specified here are *linewidth* and</span>
<span class="sd">         *elinewidth*</span>
<span class="sd">     * legend : dict, optional</span>
<span class="sd">         Dictionary mapping each value of yvals with a legend label. If not</span>
<span class="sd">         specified, it is not plotted. If you wish to plot it with the</span>
<span class="sd">         name of the line, set it to put yvals or ymetrics, depending on which</span>
<span class="sd">         one is used</span>
<span class="sd">     * legend_loc : str, optional</span>
<span class="sd">         Legend location, e.g. &#39;upper left&#39;</span>
<span class="sd">     * legend_args : dict, optional</span>
<span class="sd">         Optional legend arguments, such as ncol</span>
<span class="sd">     * plotempty : bool, optional</span>
<span class="sd">         If *True*, plot and save graph even if empty. Default is *True*</span>
<span class="sd">     * xmin, xmax: float, optional</span>
<span class="sd">        The limits of the x axis. If not specified, they&#39;re set to the min and</span>
<span class="sd">        max values of xvals</span>
<span class="sd">     * ymin, ymax: float, optional</span>
<span class="sd">        The limits of the y axis. If not specified, they&#39;re automatically</span>
<span class="sd">        selected by Matplotlib</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;title&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;xlabel&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xlabel&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;ylabel&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ylabel&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;xscale&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xscale&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;yscale&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;yscale&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;filter&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">desc</span> <span class="ow">or</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">xvals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xvals&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;xticks&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xticks&quot;</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">xtick</span><span class="p">)</span> <span class="k">for</span> <span class="n">xtick</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xticks&quot;</span><span class="p">]])</span>
    <span class="k">if</span> <span class="s2">&quot;yticks&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;yticks&quot;</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">ytick</span><span class="p">)</span> <span class="k">for</span> <span class="n">ytick</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;yticks&quot;</span><span class="p">]])</span>
    <span class="n">ymetrics</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ymetrics&quot;</span><span class="p">]</span>
    <span class="n">ycondnames</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ycondnames&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;ycondnames&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">ycondvals</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ycondvals&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;ycondvals&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">ycondnames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ycondvals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycondnames</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycondvals</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;ymetrics, ycondnames and ycondvals must have the same length&quot;</span>
            <span class="p">)</span>
        <span class="c1"># yvals is basically the list of values that differentiate each line</span>
        <span class="c1"># it is used for legends and styles mainly</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">ycondvals</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">,</span> <span class="n">ycondvals</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">ymetrics</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plot_args&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">plot_empty</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plotempty&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">empty</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yvals</span><span class="p">)):</span>
        <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xvals</span><span class="p">))</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xvals</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xvals</span><span class="p">)):</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">])</span>
            <span class="n">condition</span><span class="o">.</span><span class="n">setval</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xparam&quot;</span><span class="p">],</span> <span class="n">xvals</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ycondnames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">condition</span><span class="o">.</span><span class="n">setval</span><span class="p">(</span><span class="n">ycondnames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ycondvals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">v</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">resultset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">]</span>
            <span class="n">confidence</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;confidence&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="mf">0.95</span>
            <span class="n">means</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">err</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">means_confidence_interval</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">confidence</span><span class="p">)</span>
        <span class="n">yerr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">&quot;errorbar&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;errorbar&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="n">err</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">err</span>
        <span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;line_style&quot;</span><span class="p">][</span><span class="n">yvals</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s2">&quot;line_style&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="ow">and</span> <span class="n">yvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;line_style&quot;</span><span class="p">]</span>
            <span class="k">else</span> <span class="s2">&quot;-&quot;</span>
        <span class="p">)</span>
        <span class="c1"># This check is to prevent crashing when trying to plot arrays of nan</span>
        <span class="c1"># values with axes log scale</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xvals</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">means</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_args</span><span class="p">)</span>
            <span class="n">empty</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plot_empty</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">x_min</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xmin&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;xmin&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="nb">min</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xmax&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;xmax&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="nb">max</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;ymin&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ymin&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;ymax&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ymax&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;legend&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="p">[</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;legend&quot;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">yvals</span><span class="p">]</span>
        <span class="n">legend_args</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;legend_args&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;legend_args&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;legend_loc&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
            <span class="n">legend_args</span><span class="p">[</span><span class="s2">&quot;loc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;legend_loc&quot;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">LEGEND_SIZE</span><span class="p">},</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plotdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_bar_chart"><a class="viewcode-back" href="../../../apidoc/icarus.results.html#icarus.results.plot.plot_bar_chart">[docs]</a><span class="k">def</span> <span class="nf">plot_bar_chart</span><span class="p">(</span><span class="n">resultset</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">plotdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a bar chart with characteristics described in the plot descriptor</span>
<span class="sd">    out of the data contained in the resultset and save the plot in given</span>
<span class="sd">    directory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rs : ResultSet</span>
<span class="sd">        Result set</span>
<span class="sd">    desc : dict</span>
<span class="sd">        The plot descriptor (more info below)</span>
<span class="sd">    filename : str</span>
<span class="sd">        The name used to save the file. The file format is determined by the</span>
<span class="sd">        extension of the file. For example, if this filename is &#39;foo.pdf&#39;, the</span>
<span class="sd">        file will be saved in pdf format.</span>
<span class="sd">    plotdir : str</span>
<span class="sd">        The directory in which the plot will be saved.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The plot descriptor is a dictionary with a set of values that describe how</span>
<span class="sd">    to make the plot.</span>

<span class="sd">    The dictionary can contain the following keys:</span>
<span class="sd">     * title : str, optional.</span>
<span class="sd">           The title of the graph</span>
<span class="sd">     * xlabel : str, optional</span>
<span class="sd">         The x label</span>
<span class="sd">     * ylabel : str, optional</span>
<span class="sd">         The y label</span>
<span class="sd">     * errorbar : bool, optional</span>
<span class="sd">         If *True* error bars will be plotted. Default value is *True*</span>
<span class="sd">     * confidence : float, optional</span>
<span class="sd">         The confidence used to plot error bars. Default value is 0.95</span>
<span class="sd">     * filter : tree or dict of dicts, optional</span>
<span class="sd">         A tree or nested dictionary of values to include from the resultset.</span>
<span class="sd">         Example: {&#39;cache_placement&#39;: {&#39;network_cache&#39;: 0.004},</span>
<span class="sd">         &#39;topology&#39;: {&#39;name&#39;, &#39;GEANT&#39;}}.</span>
<span class="sd">         If not specified or None, no filtering is executed on the results</span>
<span class="sd">         and possibly heterogeneous results may be plotted together.</span>
<span class="sd">     * xparam : tuple</span>
<span class="sd">         The path of the x axis metric, e.g. (&#39;workload&#39;, &#39;alpha&#39;)</span>
<span class="sd">     * xvals : list</span>
<span class="sd">         Range of x values, e.g. [0.6, 0.7, 0.8, 0.9]</span>
<span class="sd">     * xticks : list, optional</span>
<span class="sd">         Names to display as ticks. If not specified, xvals is used instead</span>
<span class="sd">     * ymetrics : list of tuples</span>
<span class="sd">         List of metrics to be shown on the graph. The i-th metric of the list</span>
<span class="sd">         is the metric that the i-th bar on the graph will represent. If</span>
<span class="sd">         all bars are for the same metric, then all elements of the list are</span>
<span class="sd">         equal.</span>
<span class="sd">         Each single metric (i.e. each element of the list) is a tuple modeling</span>
<span class="sd">         the path to identify a specific metric into an entry of a result set.</span>
<span class="sd">         Normally, it is a 2-value list where the first value is the name of</span>
<span class="sd">         the collector which measured the metric and the second value is the</span>
<span class="sd">         metric name. Example values could be (&#39;CACHE_HIT_RATIO&#39;, &#39;MEAN&#39;),</span>
<span class="sd">         (&#39;LINK_LOAD&#39;, &#39;MEAN_INTERNAL&#39;) or (&#39;LATENCY&#39;, &#39;MEAN&#39;).</span>
<span class="sd">         For example, if in a graph of N bars all bar of the graph show mean</span>
<span class="sd">         latency, then ymetrics = [(&#39;LATENCY&#39;, &#39;MEAN&#39;)]*5.</span>
<span class="sd">     * ycondnames : list of tuples, optional</span>
<span class="sd">         List of condition names specific to each bar of the graph. Different</span>
<span class="sd">         from the conditions expressed in the filter parameter, which are</span>
<span class="sd">         global, these conditions are specific to one bar. Ech condition name,</span>
<span class="sd">         different from the filter parameter is a path to a condition to be</span>
<span class="sd">         checked, e.g. (&#39;topology&#39;, &#39;name&#39;). Values to be matched for this</span>
<span class="sd">         conditions are specified in ycondvals. This list must be as long as</span>
<span class="sd">         the number of bars to plot. If not specified, all bars are filtered</span>
<span class="sd">         by the conditions of filter parameter only, but in this case all</span>
<span class="sd">         ymetrics should be different.</span>
<span class="sd">     * ycondvals : list of values, optional</span>
<span class="sd">         List of values that the conditions of ycondnames must meet. This list</span>
<span class="sd">         must be as long as the number of bars to plot. If not specified,</span>
<span class="sd">         all bars are filtered by the conditions of filter parameter only,</span>
<span class="sd">         but in this case all ymetrics should be different.</span>
<span class="sd">     * placement : (grouped | stacked | [x, y, ...])</span>
<span class="sd">         Defines how to place bars in the plot. If grouped, defaults, all</span>
<span class="sd">         bars for a specific xval are grouped next to each other, if stacked,</span>
<span class="sd">         they are plot on top of each other. It is also possible to specify a</span>
<span class="sd">         custom grouped+stacked placement with a list of integers, in which</span>
<span class="sd">         the number of items is the number of columns and the actual value of</span>
<span class="sd">         an items is the number of metrics stacked on the column. For example</span>
<span class="sd">         [4,2,3] means plotting 4 + 2 + 3 = 9 metrics: 4 stacked in the first</span>
<span class="sd">         column, 2 stacked on the second and 3 stacked on the third</span>
<span class="sd">         If *True*, draw all bars of a group stacked on top of each other.</span>
<span class="sd">         Default value is *False*.</span>
<span class="sd">     * group_width : float, default: 0.4</span>
<span class="sd">         Width of a group of bars</span>
<span class="sd">     * bar_color : dict, optional</span>
<span class="sd">         Dictionary mapping each value of yvals with a bar color</span>
<span class="sd">     * bar_hatch : dict, optional</span>
<span class="sd">         Dictionary mapping each value of yvals with a bar hatch. If set to</span>
<span class="sd">         None all bars will be plotted without hatch. If not set, hatches will</span>
<span class="sd">         be plotted randomly</span>
<span class="sd">     * legend : dict, optional</span>
<span class="sd">         Dictionary mapping each value of yvals with a legend label. If not</span>
<span class="sd">         specified, it is not plotted. If you wish to plot it with the</span>
<span class="sd">         name of the line, set it to put yvals or ymetrics, depending on which</span>
<span class="sd">         one is used</span>
<span class="sd">     * legend_loc : str, optional</span>
<span class="sd">         Legend location, e.g. &#39;upper left&#39;</span>
<span class="sd">     * legend_args : dict, optional</span>
<span class="sd">         Optional legend arguments, such as ncol</span>
<span class="sd">     * plotempty : bool, optional</span>
<span class="sd">         If *True*, plot and save graph even if empty. Default is *True*</span>
<span class="sd">     * ymax: float, optional</span>
<span class="sd">        The upper limit of the y axis. If not specified, it is automatically</span>
<span class="sd">        selected by Matplotlib</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;title&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
    <span class="c1"># Set axis below bars</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;xlabel&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xlabel&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;ylabel&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ylabel&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;filter&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">desc</span> <span class="ow">or</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">plot_empty</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plotempty&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">ymetrics</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ymetrics&quot;</span><span class="p">]</span>
    <span class="n">ycondnames</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ycondnames&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;ycondnames&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">ycondvals</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ycondvals&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;ycondvals&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">ycondnames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ycondvals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycondnames</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycondvals</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;ymetrics, ycondnames and ycondvals must have the same length&quot;</span>
            <span class="p">)</span>
        <span class="c1"># yvals is basically the list of values that differentiate each bar</span>
        <span class="c1"># it is used for legends and styles mainly</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">ycondvals</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">,</span> <span class="n">ycondvals</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">ymetrics</span>
    <span class="n">placement</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;placement&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;placement&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="s2">&quot;grouped&quot;</span>
    <span class="k">if</span> <span class="n">placement</span> <span class="o">==</span> <span class="s2">&quot;grouped&quot;</span><span class="p">:</span>
        <span class="n">placement</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yvals</span><span class="p">))]</span>
    <span class="k">elif</span> <span class="n">placement</span> <span class="o">==</span> <span class="s2">&quot;stacked&quot;</span><span class="p">:</span>
        <span class="n">placement</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">yvals</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yvals</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Placement definition incorrect. &quot;</span>
                <span class="s2">&quot;The sum of values of the list must be equal to &quot;</span>
                <span class="s2">&quot;the number of y values&quot;</span>
            <span class="p">)</span>
    <span class="n">xticks</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xticks&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;xticks&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xvals&quot;</span><span class="p">]</span>
    <span class="n">empty</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># Spacing attributes</span>
    <span class="c1"># width of a group of bars</span>
    <span class="n">group_width</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;group_width&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;group_width&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="mf">0.4</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">group_width</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span>  <span class="c1"># width of a single bar</span>
    <span class="n">separation</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># space between adjacent groups</span>
    <span class="n">border</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">separation</span>  <span class="c1"># left and right borders</span>

    <span class="n">elem</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># bar objects (for legend)</span>
    <span class="c1"># Select colors and hatches</span>
    <span class="k">if</span> <span class="s2">&quot;bar_color&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">y</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;bar_color&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yvals</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;bar_color&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yvals</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">BW_COLOR_CATALOGUE</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="p">{</span><span class="n">y</span><span class="p">:</span> <span class="n">BW_COLOR_CATALOGUE</span><span class="p">[</span><span class="n">yvals</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yvals</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;bar_hatch&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="ow">and</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;bar_hatch&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hatch</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;bar_hatch&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">y</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;bar_hatch&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yvals</span><span class="p">):</span>
        <span class="n">hatch</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;bar_hatch&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">yvals</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">BW_COLOR_CATALOGUE</span><span class="p">):</span>
        <span class="n">hatch</span> <span class="o">=</span> <span class="p">{</span><span class="n">y</span><span class="p">:</span> <span class="n">HATCH_CATALOGUE</span><span class="p">[</span><span class="n">yvals</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">y</span><span class="p">)]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yvals</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hatch</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Plot bars</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">border</span>  <span class="c1"># left-most point of the bar about to draw</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xvals&quot;</span><span class="p">])):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">placement</span><span class="p">:</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Bottom point of a bar. It is alway 0 if stacked is False</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">])</span>
                <span class="n">condition</span><span class="o">.</span><span class="n">setval</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xparam&quot;</span><span class="p">],</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xvals&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">ycondnames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">condition</span><span class="o">.</span><span class="n">setval</span><span class="p">(</span><span class="n">ycondnames</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">ycondvals</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">resultset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">]</span>
                <span class="n">confidence</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;confidence&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="mf">0.95</span>
                <span class="n">meanval</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">means_confidence_interval</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">confidence</span><span class="p">)</span>
                <span class="n">yerr</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="s2">&quot;errorbar&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;errorbar&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">err</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">meanval</span><span class="p">):</span>
                    <span class="n">empty</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">elem</span><span class="p">[</span><span class="n">yvals</span><span class="p">[</span><span class="n">l</span><span class="p">]]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
                    <span class="n">left</span><span class="p">,</span>
                    <span class="n">meanval</span><span class="p">,</span>
                    <span class="n">width</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">yvals</span><span class="p">[</span><span class="n">l</span><span class="p">]],</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="n">yerr</span><span class="p">,</span>
                    <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span><span class="p">,</span>
                    <span class="n">ecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                    <span class="n">hatch</span><span class="o">=</span><span class="n">hatch</span><span class="p">[</span><span class="n">yvals</span><span class="p">[</span><span class="n">l</span><span class="p">]],</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">yvals</span><span class="p">[</span><span class="n">l</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">bottom</span> <span class="o">+=</span> <span class="n">meanval</span>
                <span class="n">l</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">left</span> <span class="o">+=</span> <span class="n">width</span>
        <span class="n">left</span> <span class="o">+=</span> <span class="n">separation</span>
    <span class="k">if</span> <span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plot_empty</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">n_bars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">placement</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span>
        <span class="n">border</span>
        <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_bars</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">separation</span> <span class="o">+</span> <span class="n">n_bars</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xticks</span><span class="p">)),</span>
        <span class="n">xticks</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;legend&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="p">[</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;legend&quot;</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">yvals</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;legend&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="n">yvals</span>
        <span class="n">legend_args</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;legend_args&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;legend_args&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;legend_loc&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
            <span class="n">legend_args</span><span class="p">[</span><span class="s2">&quot;loc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;legend_loc&quot;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="p">[</span><span class="n">elem</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">yvals</span><span class="p">],</span> <span class="n">legend</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">LEGEND_SIZE</span><span class="p">},</span> <span class="o">**</span><span class="n">legend_args</span>
        <span class="p">)</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">left</span> <span class="o">-</span> <span class="n">separation</span> <span class="o">+</span> <span class="n">border</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;ymax&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ymax&quot;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plotdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_cdf"><a class="viewcode-back" href="../../../apidoc/icarus.results.html#icarus.results.plot.plot_cdf">[docs]</a><span class="k">def</span> <span class="nf">plot_cdf</span><span class="p">(</span><span class="n">resultset</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">plotdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot a CDF with characteristics described in the plot descriptor</span>
<span class="sd">    out of the data contained in the resultset and save the plot in given</span>
<span class="sd">    directory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rs : ResultSet</span>
<span class="sd">        Result set</span>
<span class="sd">    desc : dict</span>
<span class="sd">        The plot descriptor (more info below)</span>
<span class="sd">    filename : str</span>
<span class="sd">        The name used to save the file. The file format is determined by the</span>
<span class="sd">        extension of the file. For example, if this filename is &#39;foo.pdf&#39;, the</span>
<span class="sd">        file will be saved in pdf format.</span>
<span class="sd">    plotdir : str</span>
<span class="sd">        The directory in which the plot will be saved.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The plot descriptor is a dictionary with a set of values that describe how</span>
<span class="sd">    to make the plot.</span>

<span class="sd">    The dictionary can contain the following keys:</span>
<span class="sd">     * title : str, optional.</span>
<span class="sd">           The title of the graph</span>
<span class="sd">     * xlabel : str, optional</span>
<span class="sd">         The x label</span>
<span class="sd">     * ylabel : str, optional</span>
<span class="sd">         The y label. The default value is &#39;Cumulative probability&#39;</span>
<span class="sd">     * confidence : float, optional</span>
<span class="sd">         The confidence used to plot error bars. Default value is 0.95</span>
<span class="sd">     * metric : list</span>
<span class="sd">         A list of values representing the metric to plot. These values are the</span>
<span class="sd">         path to identify a specific metric into an entry of a result set.</span>
<span class="sd">         Normally, it is a 2-value list where the first value is the name of</span>
<span class="sd">         the collector which measured the metric and the second value is the</span>
<span class="sd">         metric name. The metric must be a CDF.</span>
<span class="sd">         Example values could be [&#39;LATENCY&#39;, &#39;CDF&#39;].</span>
<span class="sd">     * filter : dict, optional</span>
<span class="sd">         A dictionary of values to filter in the resultset.</span>
<span class="sd">         Example: {&#39;network_cache&#39;: 0.004, &#39;topology_name&#39;: &#39;GEANT&#39;}</span>
<span class="sd">         If not specified or None, no filtering is executed on the results</span>
<span class="sd">         and possibly heterogeneous results may be plotted together</span>
<span class="sd">     * ymetrics : list of tuples</span>
<span class="sd">         List of metrics to be shown on the graph. The i-th metric of the list</span>
<span class="sd">         is the metric that the i-th line on the graph will represent. If</span>
<span class="sd">         all lines are for the same metric, then all elements of the list are</span>
<span class="sd">         equal.</span>
<span class="sd">         Each single metric (i.e. each element of the list) is a tuple modeling</span>
<span class="sd">         the path to identify a specific metric into an entry of a result set.</span>
<span class="sd">         Normally, it is a 2-value list where the first value is the name of</span>
<span class="sd">         the collector which measured the metric and the second value is the</span>
<span class="sd">         metric name. Example values could be (&#39;CACHE_HIT_RATIO&#39;, &#39;MEAN&#39;),</span>
<span class="sd">         (&#39;LINK_LOAD&#39;, &#39;MEAN_INTERNAL&#39;) or (&#39;LATENCY&#39;, &#39;MEAN&#39;).</span>
<span class="sd">         For example, if in a graph of N lines all lines of the graph show mean</span>
<span class="sd">         latency, then ymetrics = [(&#39;LATENCY&#39;, &#39;MEAN&#39;)]*5.</span>
<span class="sd">     * ycondnames : list of tuples, optional</span>
<span class="sd">         List of condition names specific to each line of the graph. Different</span>
<span class="sd">         from the conditions expressed in the filter parameter, which are</span>
<span class="sd">         global, these conditions are specific to one bar. Ech condition name,</span>
<span class="sd">         different from the filter parameter is a path to a condition to be</span>
<span class="sd">         checked, e.g. (&#39;topology&#39;, &#39;name&#39;). Values to be matched for this</span>
<span class="sd">         conditions are specified in ycondvals. This list must be as long as</span>
<span class="sd">         the number of lines to plot. If not specified, all lines are filtered</span>
<span class="sd">         by the conditions of filter parameter only, but in this case all</span>
<span class="sd">         ymetrics should be different.</span>
<span class="sd">     * ycondvals : list of tuples, optional</span>
<span class="sd">         List of values that the conditions of ycondnames must meet. This list</span>
<span class="sd">         must be as long as the number of lines to plot. If not specified,</span>
<span class="sd">         all lines are filtered by the conditions of filter parameter only,</span>
<span class="sd">         but in this case all ymetrics should be different.</span>
<span class="sd">     * xscale : str, optional</span>
<span class="sd">         The scale of x axis. Options allowed are &#39;linear&#39; and &#39;log&#39;.</span>
<span class="sd">         Default value is &#39;linear&#39;</span>
<span class="sd">     * yscale : str, optional</span>
<span class="sd">         The scale of y axis. Options allowed are &#39;linear&#39; and &#39;log&#39;.</span>
<span class="sd">         Default value is &#39;linear&#39;</span>
<span class="sd">     * step : bool, optional</span>
<span class="sd">         If *True* draws the CDF with steps. Default value is *True*</span>
<span class="sd">     * line_style : dict, optional</span>
<span class="sd">         Dictionary mapping each value of yvals with a line style</span>
<span class="sd">     * legend : dict, optional</span>
<span class="sd">         Dictionary mapping each value of yvals with a legend label. If not</span>
<span class="sd">         specified, it is not plotted. If you wish to plot it with the</span>
<span class="sd">         name of the line, set it to put yvals or ymetrics, depending on which</span>
<span class="sd">         one is used</span>
<span class="sd">     * legend_loc : str, optional</span>
<span class="sd">         Legend location, e.g. &#39;upper left&#39;</span>
<span class="sd">     * legend_args : dict, optional</span>
<span class="sd">         Optional legend arguments, such as ncol</span>
<span class="sd">     * plotempty : bool, optional</span>
<span class="sd">         If *True*, plot and save graph even if empty. Default is *True*</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;title&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;xlabel&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xlabel&quot;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ylabel&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;ylabel&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="s2">&quot;Cumulative probability&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;xscale&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;xscale&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;yscale&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;yscale&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;filter&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">desc</span> <span class="ow">or</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;step&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="kc">True</span>
    <span class="n">plot_empty</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;plotempty&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">ymetrics</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ymetrics&quot;</span><span class="p">]</span>
    <span class="n">ycondnames</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ycondnames&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;ycondnames&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">ycondvals</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;ycondvals&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;ycondvals&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">ycondnames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ycondvals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycondnames</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycondvals</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;ymetrics, ycondnames and ycondvals must have the same length&quot;</span>
            <span class="p">)</span>
        <span class="c1"># yvals is basically the list of values that differentiate each line</span>
        <span class="c1"># it is used for legends and styles mainly</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">ycondvals</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">,</span> <span class="n">ycondvals</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">ymetrics</span>
    <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">infty</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">infty</span>
    <span class="n">empty</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yvals</span><span class="p">)):</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ycondnames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">condition</span><span class="o">.</span><span class="n">setval</span><span class="p">(</span><span class="n">ycondnames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ycondvals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">v</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">resultset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">getval</span><span class="p">(</span><span class="n">ymetrics</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="c1"># If there are more than 1 CDFs in the resultset, take the first one</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">x_cdf</span><span class="p">,</span> <span class="n">y_cdf</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">step</span><span class="p">:</span>
                <span class="n">x_cdf</span><span class="p">,</span> <span class="n">y_cdf</span> <span class="o">=</span> <span class="n">step_cdf</span><span class="p">(</span><span class="n">x_cdf</span><span class="p">,</span> <span class="n">y_cdf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_cdf</span><span class="p">,</span> <span class="n">y_cdf</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;line_style&quot;</span><span class="p">][</span><span class="n">yvals</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s2">&quot;line_style&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="ow">and</span> <span class="n">yvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;line_style&quot;</span><span class="p">]</span>
            <span class="k">else</span> <span class="s2">&quot;-&quot;</span>
        <span class="p">)</span>
        <span class="c1"># This check is to prevent crashing when trying to plot arrays of nan</span>
        <span class="c1"># values with axes log scale</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_cdf</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">y_cdf</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">fmt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_cdf</span><span class="p">,</span> <span class="n">y_cdf</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
            <span class="n">empty</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">x_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_cdf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">x_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_max</span><span class="p">,</span> <span class="n">x_cdf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plot_empty</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;legend&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="p">[</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;legend&quot;</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;yvals&quot;</span><span class="p">]]</span>
        <span class="n">legend_args</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;legend_args&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;legend_args&quot;</span> <span class="ow">in</span> <span class="n">desc</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;legend_loc&quot;</span> <span class="ow">in</span> <span class="n">desc</span><span class="p">:</span>
            <span class="n">legend_args</span><span class="p">[</span><span class="s2">&quot;loc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="s2">&quot;legend_loc&quot;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">LEGEND_SIZE</span><span class="p">},</span> <span class="o">**</span><span class="n">legend_args</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">LEGEND_SIZE</span><span class="p">},</span> <span class="n">loc</span><span class="o">=</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;legend_loc&quot;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plotdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Icarus 0.8.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">icarus.results.plot</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Lorenzo Saino, Ioannis Psaras.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.1.1.
    </div>
  </body>
</html>